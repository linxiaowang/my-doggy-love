name: Check Secrets

on:
  workflow_dispatch:

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    if: false  # 仅用于检查，不会自动运行

    steps:
      - name: Check required secrets
        run: |
          echo "检查 GitHub Secrets 配置状态"
          echo "=================================="
          echo ""

          # 必需的 Secrets
          secrets=(
            "SERVER_HOST"
            "SERVER_USER"
            "SSH_PRIVATE_KEY"
            "DATABASE_URL"
            "AUTH_SECRET"
            "NUXT_PUBLIC_VAPID_KEY"
            "NUXT_VAPID_PRIVATE_KEY"
            "NUXT_VAPID_SUBJECT"
          )

          all_configured=true

          for secret in "${secrets[@]}"; do
            if [ -z "${!secret}" ]; then
              echo "❌ $secret - 未配置"
              all_configured=false
            else
              # 检查值是否为占位符
              if [[ "${!secret}" == *"your-"* ]] || [[ "${!secret}" == *"placeholder"* ]]; then
                echo "⚠️  $secret - 已配置但值是占位符"
                all_configured=false
              else
                echo "✅ $secret - 已配置"
              fi
            fi
          done

          echo ""
          echo "=================================="
          if [ "$all_configured" = true ]; then
            echo "✅ 所有必需的 Secrets 都已配置"
            exit 0
          else
            echo "❌ 部分 Secrets 未配置或使用占位符"
            echo ""
            echo "请在 GitHub 仓库设置中配置这些 Secrets："
            echo "https://github.com/你的用户名/我的狗狗爱情/settings/secrets/actions"
            exit 1
          fi
        env:
          SERVER_HOST: ${{ secrets.SERVER_HOST }}
          SERVER_USER: ${{ secrets.SERVER_USER }}
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          AUTH_SECRET: ${{ secrets.AUTH_SECRET }}
          NUXT_PUBLIC_VAPID_KEY: ${{ secrets.NUXT_PUBLIC_VAPID_KEY }}
          NUXT_VAPID_PRIVATE_KEY: ${{ secrets.NUXT_VAPID_PRIVATE_KEY }}
          NUXT_VAPID_SUBJECT: ${{ secrets.NUXT_VAPID_SUBJECT }}
