import{M as Ye,k as re,d as L,c as Y,r as T,o as We,z as Qe,w as Xe,E as Ze,m as _,e as t,u as e,h as r,g as i,f as a,a as d,b as D,t as h,F as A,n as N,i as x,s as Je,D as ce,q as Z,x as He,N as M,A as et,O as Q,P as tt,Q as at,R as Ke,U as W,V as Ge,W as st,p as _e,$ as me,X as se,Y as lt,Z as ot,a0 as Oe,a1 as Re,a2 as Me,a3 as de,a4 as nt,a5 as rt,a6 as J,a7 as it,a8 as dt,a9 as ut,aa as ct,ab as ft,ac as mt,ad as pt,ae as vt,af as ht,ag as gt,ah as yt,ai as _t,aj as xt,ak as bt,al as wt,am as kt,an as $t,ao as Ct,ap as Pt,aq as Vt,ar as Bt,as as jt,_ as Ut,at as Tt,L as Dt,K as Mt}from"./DW3SVq1p.js";import{a as ue,_ as S,b as Ve,c as Be,d as je,e as q,f as ze,D as zt}from"./Cv5foL5a.js";import{E as At}from"./BeFyUl0g.js";import{S as Lt}from"./Cf2i4mGW.js";import{b as Te,a as ye,_ as De}from"./DHqhx6bH.js";import{_ as Ot}from"./-giXuYDd.js";import{_ as Se}from"./BvfOXczi.js";async function Rt(s){return re("/api/daily",{method:"POST",body:s})}function St(s){const l=typeof s=="function"?()=>`/api/daily/${s()}/comments`:`/api/daily/${s}/comments`;return Ye(l)}async function Ft(s,l){return re(`/api/daily/${s}/comment`,{method:"POST",body:{content:l}})}async function Et(s){return re(`/api/daily/${s}`,{method:"DELETE"})}function It(s){if(!s||s.includes("/thumb_"))return s;const l=s.split("/"),n=l[l.length-1];if(n.startsWith("thumb_"))return s;const p=`thumb_${n}`;return l[l.length-1]=p,l.join("/")}const Nt={class:"flex items-center gap-2 text-sm text-muted-foreground mb-4"},Wt={key:0,class:"ml-auto inline-flex flex-wrap gap-1.5"},Ht={class:"mt-2 text-foreground leading-relaxed whitespace-pre-wrap break-words"},Kt={key:0,class:"mt-4 grid grid-cols-3 gap-2"},Gt=["onClick"],qt={key:0,class:"relative w-full h-full bg-muted"},Yt=["src","data-original"],Qt={key:1,class:"w-full h-full bg-muted flex items-center justify-center relative group-hover:bg-muted/80 transition-colors duration-300"},Xt=["src"],Zt={key:2,class:"w-full h-full bg-muted flex items-center justify-center"},Jt=["src"],ea=["src"],ta={key:2,class:"absolute bottom-6 left-1/2 -translate-x-1/2 px-4 py-1.5 rounded-full bg-white/10 backdrop-blur-md text-white/90 text-sm font-medium border border-white/5"},aa={class:"mt-4 flex items-center gap-2 text-sm border-t pt-1"},sa={key:1,class:"mt-4 flex gap-2 animate-fade-in items-end"},la={class:"mt-2"},oa={key:0,class:"mt-4 space-y-4"},na={key:0,class:"text-sm text-muted-foreground py-2 text-center"},ra={key:1,class:"text-sm text-muted-foreground py-2 text-center"},ia={key:2,class:"space-y-4 pl-1"},da={class:"flex items-start gap-3"},ua={class:"flex-1 space-y-1"},ca={class:"flex items-center justify-between"},fa={class:"text-sm font-medium text-foreground"},ma={class:"text-xs text-muted-foreground"},pa={class:"text-sm text-foreground/90"},va={class:"flex items-center gap-2 pt-1"},ha={key:0,class:"mt-2 flex items-center gap-2"},ga={key:0,class:"pl-11 space-y-3"},ya={class:"flex items-start gap-3"},_a={class:"flex-1 space-y-1"},xa={class:"flex items-center justify-between"},ba={class:"text-sm font-medium text-foreground"},wa={class:"text-xs text-muted-foreground"},ka={class:"text-sm text-foreground/90"},$a={class:"flex items-center gap-2 pt-1"},Ca={key:0,class:"mt-2 flex items-center gap-2"},Pa={key:0,class:"pl-9 space-y-2"},Va={class:"flex-1 space-y-1"},Ba={class:"flex items-center justify-between"},ja={class:"text-sm font-medium text-foreground"},Ua={class:"text-xs text-muted-foreground"},Ta={class:"text-sm text-foreground/90"},Da=L({__name:"PostCard",props:{id:{},content:{},createdAt:{},mediaUrls:{},commentCount:{},tags:{},authorId:{}},emits:["commented","deleted"],setup(s,{emit:l}){const n=s,p=l,f=Y(()=>new Date(n.createdAt).toLocaleString()),v=T(""),g=T(!1),j=T([]),k=Y(()=>{const y=m=>m.reduce((b,P)=>b+1+(Array.isArray(P.replies)?y(P.replies):0),0);return j.value.length?y(j.value):n.commentCount||0}),K=Y(()=>k.value>0?`(${k.value})`:""),O=T(!1),$=T(null),F=T(""),C=T(null),B=Y(()=>C.value===null||!n.mediaUrls?null:n.mediaUrls[C.value]);function R(y){if(!y)return!1;const m=y.toLowerCase();return m.match(/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?|#|$)/i)!==null||m.includes("image/")||m.startsWith("data:image/")}function U(y){if(!y)return!1;const m=y.toLowerCase();return m.match(/\.(mp4|webm|ogg|mov|avi|wmv|flv|mkv)(\?|#|$)/i)!==null||m.includes("video/")||m.startsWith("data:video/")}function G(y){y.target}function X(y){const m=y.target,b=m.getAttribute("data-original");b&&m.src!==b&&(m.src=b)}function ee(y){C.value=y,document.body.style.overflow="hidden"}function te(){C.value=null,document.body.style.overflow=""}function ae(){C.value!==null&&C.value>0&&C.value--}function pe(){C.value!==null&&n.mediaUrls&&C.value<n.mediaUrls.length-1&&C.value++}function ve(y){C.value!==null&&(y.key==="Escape"?te():y.key==="ArrowLeft"?ae():y.key==="ArrowRight"&&pe())}We(()=>{typeof window<"u"&&window.addEventListener("keydown",ve)}),Qe(()=>{typeof window<"u"&&window.removeEventListener("keydown",ve),document.body.style.overflow=""});const{data:xe,pending:be,refresh:le}=St(()=>n.id);Xe(xe,y=>{y?.items&&(j.value=y.items)},{immediate:!0});const we=Y(()=>be.value);async function he(){if(v.value)try{await Ft(n.id,v.value),v.value="",O.value=!1,g.value=!0,await le(),p("commented")}catch(y){console.error("发布评论失败:",y)}}async function ke(){g.value=!g.value,g.value&&j.value.length===0&&await le()}function $e(){O.value=!O.value}async function oe(y){if(F.value)try{await re(`/api/daily/comments/${y}/reply`,{method:"POST",body:{content:F.value}}),F.value="",$.value=null,g.value=!0,g.value&&await le()}catch(m){console.error("回复评论失败:",m)}}function ge(y){$.value=$.value===y?null:y}const Ce=Ze(),Pe=Y(()=>{const y=Ce.user?.id;return n.authorId&&y&&n.authorId===y});async function fe(){if(confirm("确定要删除这条日常记录吗？"))try{await Et(n.id),p("deleted")}catch(y){console.error("删除失败:",y),alert(y?.friendlyMessage||"删除失败，请稍后再试")}}return(y,m)=>(t(),_(e(Te),{class:"mb-4"},{default:r(()=>[i(e(De),null,{default:r(()=>[a("div",Nt,[a("span",null,h(f.value),1),s.tags?.length?(t(),d("span",Wt,[(t(!0),d(A,null,N(s.tags,b=>(t(),_(e(ue),{key:b,variant:"secondary",class:"hover:bg-secondary/80"},{default:r(()=>[x(h(b),1)]),_:2},1024))),128))])):D("",!0)]),a("div",Ht,h(s.content),1),s.mediaUrls?.length?(t(),d("div",Kt,[(t(!0),d(A,null,N(s.mediaUrls,(b,P)=>(t(),d("div",{key:P,class:"relative cursor-pointer overflow-hidden rounded-lg group shadow-sm hover:shadow-md transition-all duration-300 aspect-square",onClick:E=>ee(P)},[R(b)?(t(),d("div",qt,[a("img",{src:e(It)(b),"data-original":b,loading:"lazy",decoding:"async",class:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 opacity-0 transition-opacity duration-300",onError:X,onLoad:m[0]||(m[0]=E=>E.target.classList.remove("opacity-0"))},null,40,Yt)])):U(b)?(t(),d("div",Qt,[a("video",{src:b,class:"w-full h-full object-cover",preload:"metadata",muted:"",onLoadedmetadata:G},null,40,Xt),m[5]||(m[5]=a("div",{class:"absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/30 transition-colors duration-300"},[a("svg",{class:"w-10 h-10 text-white drop-shadow-lg",fill:"currentColor",viewBox:"0 0 24 24"},[a("path",{d:"M8 5v14l11-7z"})])],-1))])):(t(),d("div",Zt,[...m[6]||(m[6]=[a("span",{class:"text-xs text-muted-foreground"},"未知类型",-1)])]))],8,Gt))),128))])):D("",!0),(t(),_(Je,{to:"body"},[C.value!==null?(t(),d("div",{key:0,class:"fixed inset-0 z-50 bg-black/95 flex items-center justify-center backdrop-blur-sm",onClick:Z(te,["self"]),onKeydown:ce(te,["esc"])},[a("button",{class:"absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-50 transition-all duration-200 hover:scale-110 active:scale-95 border-none cursor-pointer",onClick:te},[...m[7]||(m[7]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),s.mediaUrls&&s.mediaUrls.length>1&&C.value!==null&&C.value>0?(t(),d("button",{key:0,class:"absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-50 cursor-pointer transition-all duration-200 hover:scale-110 active:scale-95 border-none",onClick:Z(ae,["stop","prevent"]),type:"button"},[...m[8]||(m[8]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):D("",!0),s.mediaUrls&&s.mediaUrls.length>1&&C.value!==null&&C.value<s.mediaUrls.length-1?(t(),d("button",{key:1,class:"absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-50 cursor-pointer transition-all duration-200 hover:scale-110 active:scale-95 border-none",onClick:Z(pe,["stop","prevent"]),type:"button"},[...m[9]||(m[9]=[a("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):D("",!0),a("div",{class:"max-w-[90vw] max-h-[90vh] flex items-center justify-center w-full h-full p-4",onClick:m[1]||(m[1]=Z(()=>{},["stop"]))},[B.value&&R(B.value)?(t(),d("img",{key:0,src:B.value,class:"max-w-full max-h-[85vh] object-contain shadow-2xl rounded-sm select-none",alt:"预览"},null,8,Jt)):B.value&&U(B.value)?(t(),d("video",{key:1,src:B.value,class:"max-w-full max-h-[85vh] shadow-2xl rounded-sm",controls:"",autoplay:""},null,8,ea)):D("",!0)]),s.mediaUrls&&s.mediaUrls.length>1?(t(),d("div",ta,h(C.value+1)+" / "+h(s.mediaUrls.length),1)):D("",!0)],32)):D("",!0)])),a("div",aa,[i(e(S),{variant:"ghost",size:"sm",class:"h-8 px-2 text-muted-foreground hover:text-foreground",onClick:ke},{default:r(()=>[x(h(g.value?"收起评论":`查看评论${K.value}`),1)]),_:1}),m[12]||(m[12]=a("span",{class:"text-border h-4 w-px bg-border"},null,-1)),i(e(S),{variant:"ghost",size:"sm",class:"h-8 px-2 text-muted-foreground hover:text-foreground",onClick:$e},{default:r(()=>[x(h(O.value?"收起输入":"写评论"),1)]),_:1}),Pe.value?(t(),d(A,{key:0},[m[11]||(m[11]=a("span",{class:"text-border h-4 w-px bg-border"},null,-1)),i(e(S),{variant:"ghost",size:"sm",class:"h-8 px-2 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:fe},{default:r(()=>[...m[10]||(m[10]=[x(" 删除 ",-1)])]),_:1})],64)):D("",!0)]),O.value?(t(),d("div",sa,[i(e(ye),{modelValue:v.value,"onUpdate:modelValue":m[2]||(m[2]=b=>v.value=b),placeholder:"写点评论…",class:"flex-1",onKeydown:ce(Z(he,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),i(e(S),{onClick:he,disabled:!v.value.trim()},{default:r(()=>[...m[13]||(m[13]=[x("发布",-1)])]),_:1},8,["disabled"])])):D("",!0),a("div",la,[g.value?(t(),d("div",oa,[we.value?(t(),d("div",na,"加载中…")):j.value.length===0?(t(),d("div",ra,"暂无评论")):(t(),d("div",ia,[(t(!0),d(A,null,N(j.value,b=>(t(),d("div",{key:b.id,class:"space-y-2"},[a("div",da,[i(e(Ve),{class:"w-8 h-8"},{default:r(()=>[i(e(Be),{src:b.author.avatarUrl||"/assets/images/xiaobai/xiaobai-2.png"},null,8,["src"]),i(e(je),null,{default:r(()=>[x(h(b.author.nickName?.slice(0,2)||"用户"),1)]),_:2},1024)]),_:2},1024),a("div",ua,[a("div",ca,[a("span",fa,h(b.author.nickName),1),a("span",ma,h(new Date(b.createdAt).toLocaleString()),1)]),a("div",pa,h(b.content),1),a("div",va,[i(e(S),{variant:"link",size:"sm",class:"h-auto p-0 text-muted-foreground text-xs",onClick:P=>ge(b.id)},{default:r(()=>[x(h($.value===b.id?"收起回复":"回复"),1)]),_:2},1032,["onClick"])]),$.value===b.id?(t(),d("div",ha,[i(e(ye),{modelValue:F.value,"onUpdate:modelValue":m[3]||(m[3]=P=>F.value=P),placeholder:"回复…",class:"h-8 text-sm",onKeydown:ce(Z(P=>oe(b.id),["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),i(e(S),{size:"sm",class:"h-8",onClick:P=>oe(b.id),disabled:!F.value.trim()},{default:r(()=>[...m[14]||(m[14]=[x("发送",-1)])]),_:1},8,["onClick","disabled"])])):D("",!0)])]),b.replies?.length?(t(),d("div",ga,[(t(!0),d(A,null,N(b.replies,P=>(t(),d("div",{key:P.id,class:"space-y-2"},[a("div",ya,[i(e(Ve),{class:"w-6 h-6"},{default:r(()=>[i(e(Be),{src:P.author.avatarUrl||"/assets/images/xiaobai/xiaobai-2.png"},null,8,["src"]),i(e(je),null,{default:r(()=>[x(h(P.author.nickName?.slice(0,2)),1)]),_:2},1024)]),_:2},1024),a("div",_a,[a("div",xa,[a("span",ba,h(P.author.nickName),1),a("span",wa,h(new Date(P.createdAt).toLocaleString()),1)]),a("div",ka,h(P.content),1),a("div",$a,[i(e(S),{variant:"link",size:"sm",class:"h-auto p-0 text-muted-foreground text-xs",onClick:E=>ge(P.id)},{default:r(()=>[x(h($.value===P.id?"收起回复":"回复"),1)]),_:2},1032,["onClick"])]),$.value===P.id?(t(),d("div",Ca,[i(e(ye),{modelValue:F.value,"onUpdate:modelValue":m[4]||(m[4]=E=>F.value=E),placeholder:"回复…",class:"h-8 text-sm",onKeydown:ce(Z(E=>oe(P.id),["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),i(e(S),{size:"sm",class:"h-8",onClick:E=>oe(P.id),disabled:!F.value.trim()},{default:r(()=>[...m[15]||(m[15]=[x("发送",-1)])]),_:1},8,["onClick","disabled"])])):D("",!0)])]),P.replies?.length?(t(),d("div",Pa,[(t(!0),d(A,null,N(P.replies,E=>(t(),d("div",{key:E.id,class:"flex items-start gap-3"},[i(e(Ve),{class:"w-6 h-6"},{default:r(()=>[i(e(Be),{src:E.author.avatarUrl||"/assets/images/xiaobai/xiaobai-2.png"},null,8,["src"]),i(e(je),null,{default:r(()=>[x(h(E.author.nickName?.slice(0,2)),1)]),_:2},1024)]),_:2},1024),a("div",Va,[a("div",Ba,[a("span",ja,h(E.author.nickName),1),a("span",Ua,h(new Date(E.createdAt).toLocaleString()),1)]),a("div",Ta,h(E.content),1)])]))),128))])):D("",!0)]))),128))])):D("",!0)]))),128))]))])):D("",!0)])]),_:1})]),_:1}))}}),Ma=Object.assign(Da,{__name:"PostCard"}),za={},Aa={class:"timeline relative"},La={class:"space-y-6"};function Oa(s,l){return t(),d("div",Aa,[l[0]||(l[0]=a("div",{class:"rail"},null,-1)),a("div",La,[M(s.$slots,"default",{},void 0,!0)])])}const Ra=Object.assign(He(za,[["render",Oa],["__scopeId","data-v-dfa7c259"]]),{__name:"Timeline"}),Sa={},Fa={class:"relative pl-14"};function Ea(s,l){return t(),d("div",Fa,[l[0]||(l[0]=et('<div class="node" data-v-fda2d56c><svg viewBox="0 0 24 24" class="paw" data-v-fda2d56c><circle cx="7.5" cy="7.5" r="2.2" data-v-fda2d56c></circle><circle cx="12" cy="6.5" r="2.2" data-v-fda2d56c></circle><circle cx="16.5" cy="7.5" r="2.2" data-v-fda2d56c></circle><ellipse cx="12" cy="13.5" rx="4.2" ry="3.2" data-v-fda2d56c></ellipse></svg></div>',1)),a("div",null,[M(s.$slots,"default",{},void 0,!0)])])}const Ia=Object.assign(He(Sa,[["render",Ea],["__scopeId","data-v-fda2d56c"]]),{__name:"TimelineItem"}),Na={class:"group/native-select relative w-fit has-[select:disabled]:opacity-50","data-slot":"native-select-wrapper"},Fe=L({inheritAttrs:!1,__name:"NativeSelect",props:{modelValue:{},class:{}},emits:["update:modelValue"],setup(s,{emit:l}){const n=s,f=Ke(n,"modelValue",l,{passive:!0,defaultValue:""}),v=Q(n,"class");return(g,j)=>(t(),d("div",Na,[tt(a("select",W({...g.$attrs,...e(v)},{"onUpdate:modelValue":j[0]||(j[0]=k=>Ge(f)?f.value=k:null),"data-slot":"native-select",class:e(q)("border-input placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 dark:hover:bg-input/50 h-9 w-full min-w-0 appearance-none rounded-md border bg-transparent px-3 py-2 pr-9 text-sm shadow-xs transition-[color,box-shadow] outline-none disabled:pointer-events-none disabled:cursor-not-allowed","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n.class)}),[M(g.$slots,"default")],16),[[at,e(f)]]),i(e(st),{class:"text-muted-foreground pointer-events-none absolute top-1/2 right-3.5 size-4 -translate-y-1/2 opacity-50 select-none","aria-hidden":"true","data-slot":"native-select-icon"})]))}}),Ee=L({__name:"NativeSelectOption",props:{class:{}},setup(s){const l=s;return(n,p)=>(t(),d("option",{"data-slot":"native-select-option",class:_e(e(q)("bg-popover text-popover-foreground",l.class))},[M(n.$slots,"default")],2))}}),Wa={class:"**:data-[slot=native-select-icon]:right-1"},Ha={class:"relative"},Ka={class:"absolute inset-0 flex h-full items-center text-sm pl-2 pointer-events-none"},Ga={class:"**:data-[slot=native-select-icon]:right-1"},qa={class:"relative"},Ya={class:"absolute inset-0 flex h-full items-center text-sm pl-2 pointer-events-none"},Qa={class:"flex items-center gap-1 absolute top-0 inset-x-0 justify-between"},Xa={key:0,class:"flex items-center justify-center gap-1"},Za={key:1,class:"flex items-center justify-center gap-1"},Ja={key:2,class:"flex items-center justify-center gap-1"},es={class:"flex flex-col gap-y-4 mt-4 sm:flex-row sm:gap-x-4 sm:gap-y-0"},ts=L({__name:"Calendar",props:{defaultValue:{},defaultPlaceholder:{},placeholder:{},pagedNavigation:{type:Boolean},preventDeselect:{type:Boolean},weekStartsOn:{},weekdayFormat:{},calendarLabel:{},fixedWeeks:{type:Boolean},maxValue:{},minValue:{},locale:{},numberOfMonths:{},disabled:{type:Boolean},readonly:{type:Boolean},initialFocus:{type:Boolean},isDateDisabled:{},isDateUnavailable:{},dir:{},nextPage:{},prevPage:{},modelValue:{default:void 0},multiple:{type:Boolean},disableDaysOutsideCurrentView:{type:Boolean},asChild:{type:Boolean},as:{},class:{},layout:{default:void 0},yearRange:{}},emits:["update:modelValue","update:placeholder"],setup(s,{emit:l}){const n=s,p=l,f=Q(n,"class","layout","placeholder"),v=Ke(n,"placeholder",p,{passive:!0,defaultValue:n.defaultPlaceholder??me(se())}),g=lt(n.locale??"en"),j=Y(()=>n.yearRange??ot({start:n?.minValue??(Oe(n.placeholder)??n.defaultPlaceholder??me(se())).cycle("year",-100),end:n?.maxValue??(Oe(n.placeholder)??n.defaultPlaceholder??me(se())).cycle("year",10)})),[k,K]=Re(),[O,$]=Re(),F=Me(f,p);return(C,B)=>(t(),d(A,null,[i(e(k),null,{default:r(({date:R})=>[a("div",Wa,[a("div",Ha,[a("div",Ka,h(e(g).custom(e(de)(R),{month:"short"})),1),i(e(Fe),{class:"text-xs h-8 pr-6 pl-2 text-transparent relative",onChange:B[0]||(B[0]=U=>{v.value=e(v).set({month:Number(U?.target?.value)})})},{default:r(()=>[(t(!0),d(A,null,N(e(nt)({dateObj:R}),U=>(t(),_(e(Ee),{key:U.toString(),value:U.month,selected:R.month===U.month},{default:r(()=>[x(h(e(g).custom(e(de)(U),{month:"short"})),1)]),_:2},1032,["value","selected"]))),128))]),_:2},1024)])])]),_:1}),i(e(O),null,{default:r(({date:R})=>[a("div",Ga,[a("div",qa,[a("div",Ya,h(e(g).custom(e(de)(R),{year:"numeric"})),1),i(e(Fe),{class:"text-xs h-8 pr-6 pl-2 text-transparent relative",onChange:B[1]||(B[1]=U=>{v.value=e(v).set({year:Number(U?.target?.value)})})},{default:r(()=>[(t(!0),d(A,null,N(j.value,U=>(t(),_(e(Ee),{key:U.toString(),value:U.year,selected:R.year===U.year},{default:r(()=>[x(h(e(g).custom(e(de)(U),{year:"numeric"})),1)]),_:2},1032,["value","selected"]))),128))]),_:2},1024)])])]),_:1}),i(e(rt),W(e(F),{placeholder:e(v),"onUpdate:placeholder":B[2]||(B[2]=R=>Ge(v)?v.value=R:null),"data-slot":"calendar",class:e(q)("p-3",n.class)}),{default:r(({grid:R,weekDays:U,date:G})=>[i(e(is),{class:"pt-0"},{default:r(()=>[a("nav",Qa,[i(e(cs),null,{default:r(()=>[M(C.$slots,"calendar-prev-icon")]),_:3}),i(e(us),null,{default:r(()=>[M(C.$slots,"calendar-next-icon")]),_:3})]),M(C.$slots,"calendar-heading",{date:G,month:e(K),year:e($)},()=>[s.layout==="month-and-year"?(t(),d("div",Xa,[i(e(K),{date:G},null,8,["date"]),i(e($),{date:G},null,8,["date"])])):s.layout==="month-only"?(t(),d("div",Za,[i(e(K),{date:G},null,8,["date"]),x(" "+h(e(g).custom(e(de)(G),{year:"numeric"})),1)])):s.layout==="year-only"?(t(),d("div",Ja,[x(h(e(g).custom(e(de)(G),{month:"short"}))+" ",1),i(e($),{date:G},null,8,["date"])])):(t(),_(e(ds),{key:3}))])]),_:2},1024),a("div",es,[(t(!0),d(A,null,N(R,X=>(t(),_(e(ls),{key:X.value.toString()},{default:r(()=>[i(e(ns),null,{default:r(()=>[i(e(Ie),null,{default:r(()=>[(t(!0),d(A,null,N(U,ee=>(t(),_(e(rs),{key:ee},{default:r(()=>[x(h(ee),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),i(e(os),null,{default:r(()=>[(t(!0),d(A,null,N(X.rows,(ee,te)=>(t(),_(e(Ie),{key:`weekDate-${te}`,class:"mt-2 w-full"},{default:r(()=>[(t(!0),d(A,null,N(ee,ae=>(t(),_(e(as),{key:ae.toString(),date:ae},{default:r(()=>[i(e(ss),{day:ae,month:X.value},null,8,["day","month"])]),_:2},1032,["date"]))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))])]),_:3},16,["placeholder","class"])],64))}}),as=L({__name:"CalendarCell",props:{date:{},asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(it),W({"data-slot":"calendar-cell",class:e(q)("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([data-selected])]:rounded-md [&:has([data-selected])]:bg-accent",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default")]),_:3},16,["class"]))}}),ss=L({__name:"CalendarCellTrigger",props:{day:{},month:{},asChild:{type:Boolean},as:{default:"button"},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(dt),W({"data-slot":"calendar-cell-trigger",class:e(q)(e(ze)({variant:"ghost"}),"size-8 p-0 font-normal aria-selected:opacity-100 cursor-default","[&[data-today]:not([data-selected])]:bg-accent [&[data-today]:not([data-selected])]:text-accent-foreground","data-[selected]:bg-primary data-[selected]:text-primary-foreground data-[selected]:opacity-100 data-[selected]:hover:bg-primary data-[selected]:hover:text-primary-foreground data-[selected]:focus:bg-primary data-[selected]:focus:text-primary-foreground","data-[disabled]:text-muted-foreground data-[disabled]:opacity-50","data-[unavailable]:text-destructive-foreground data-[unavailable]:line-through","data-[outside-view]:text-muted-foreground",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default")]),_:3},16,["class"]))}}),ls=L({__name:"CalendarGrid",props:{asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(ut),W({"data-slot":"calendar-grid",class:e(q)("w-full border-collapse space-x-1",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default")]),_:3},16,["class"]))}}),os=L({__name:"CalendarGridBody",props:{asChild:{type:Boolean},as:{}},setup(s){const l=s;return(n,p)=>(t(),_(e(ct),W({"data-slot":"calendar-grid-body"},l),{default:r(()=>[M(n.$slots,"default")]),_:3},16))}}),ns=L({__name:"CalendarGridHead",props:{asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s;return(n,p)=>(t(),_(e(ft),W({"data-slot":"calendar-grid-head"},l),{default:r(()=>[M(n.$slots,"default")]),_:3},16))}}),Ie=L({__name:"CalendarGridRow",props:{asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(mt),W({"data-slot":"calendar-grid-row",class:e(q)("flex",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default")]),_:3},16,["class"]))}}),rs=L({__name:"CalendarHeadCell",props:{asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(pt),W({"data-slot":"calendar-head-cell",class:e(q)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem]",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default")]),_:3},16,["class"]))}}),is=L({__name:"CalendarHeader",props:{asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(vt),W({"data-slot":"calendar-header",class:e(q)("flex justify-center pt-1 relative items-center w-full px-8",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default")]),_:3},16,["class"]))}}),ds=L({__name:"CalendarHeading",props:{asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(ht),W({"data-slot":"calendar-heading",class:e(q)("text-sm font-medium",l.class)},e(p)),{default:r(({headingValue:g})=>[M(f.$slots,"default",{headingValue:g},()=>[x(h(g),1)])]),_:3},16,["class"]))}}),us=L({__name:"CalendarNextButton",props:{nextPage:{type:Function},asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(gt),W({"data-slot":"calendar-next-button",class:e(q)(e(ze)({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default",{},()=>[i(e(yt),{class:"size-4"})])]),_:3},16,["class"]))}}),cs=L({__name:"CalendarPrevButton",props:{prevPage:{type:Function},asChild:{type:Boolean},as:{},class:{}},setup(s){const l=s,n=Q(l,"class"),p=J(n);return(f,v)=>(t(),_(e(_t),W({"data-slot":"calendar-prev-button",class:e(q)(e(ze)({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100",l.class)},e(p)),{default:r(()=>[M(f.$slots,"default",{},()=>[i(e(xt),{class:"size-4"})])]),_:3},16,["class"]))}}),fs=L({__name:"Popover",props:{defaultOpen:{type:Boolean},open:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(s,{emit:l}){const f=Me(s,l);return(v,g)=>(t(),_(e(bt),W({"data-slot":"popover"},e(f)),{default:r(j=>[M(v.$slots,"default",wt(kt(j)))]),_:3},16))}}),ms=L({inheritAttrs:!1,__name:"PopoverContent",props:{forceMount:{type:Boolean},side:{},sideOffset:{default:4},sideFlip:{type:Boolean},align:{default:"center"},alignOffset:{},alignFlip:{type:Boolean},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},positionStrategy:{},updatePositionStrategy:{},disableUpdateOnLayoutShift:{type:Boolean},prioritizePosition:{type:Boolean},reference:{},asChild:{type:Boolean},as:{},disableOutsidePointerEvents:{type:Boolean},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(s,{emit:l}){const n=s,p=l,f=Q(n,"class"),v=Me(f,p);return(g,j)=>(t(),_(e($t),null,{default:r(()=>[i(e(Ct),W({"data-slot":"popover-content"},{...g.$attrs,...e(v)},{class:e(q)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 rounded-md border p-4 shadow-md origin-(--reka-popover-content-transform-origin) outline-hidden",n.class)}),{default:r(()=>[M(g.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),ps=L({__name:"PopoverTrigger",props:{asChild:{type:Boolean},as:{}},setup(s){const l=s;return(n,p)=>(t(),_(e(Pt),W({"data-slot":"popover-trigger"},l),{default:r(()=>[M(n.$slots,"default")]),_:3},16))}}),vs={class:"truncate"},hs={key:0,class:"ml-auto h-3 w-3 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ne=L({__name:"DatePicker",props:{modelValue:{},placeholder:{default:"选择日期"},defaultPlaceholder:{default:()=>me(se())}},emits:["update:modelValue"],setup(s,{emit:l}){const n=s,p=l,f=Y({get:()=>n.modelValue,set:g=>p("update:modelValue",g)}),v=new Vt("zh-CN",{dateStyle:"long"});return(g,j)=>(t(),_(e(fs),null,{default:r(({close:k})=>[i(e(ps),{"as-child":""},{default:r(()=>[i(e(S),{variant:"outline",class:_e(e(q)("w-full justify-start text-left font-normal transition-all duration-200","hover:border-primary/50 hover:shadow-sm",!f.value&&"text-muted-foreground",f.value&&"text-foreground"))},{default:r(()=>[i(e(Bt),{class:"mr-2 h-4 w-4 shrink-0"}),a("span",vs,h(f.value?e(v).format(f.value.toDate(e(se)())):s.placeholder),1),f.value?(t(),d("svg",hs,[...j[1]||(j[1]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])):D("",!0)]),_:1},8,["class"])]),_:1}),i(e(ms),{class:"w-auto p-0 shadow-lg border-border/50",align:"start"},{default:r(()=>[i(e(ts),{modelValue:f.value,"onUpdate:modelValue":[j[0]||(j[0]=K=>f.value=K),k],"default-placeholder":s.defaultPlaceholder,layout:"month-and-year","initial-focus":""},null,8,["modelValue","default-placeholder","onUpdate:modelValue"])]),_:2},1024)]),_:1}))}});async function gs(s){const l=new FormData;return s.forEach(n=>{l.append("file",n)}),re("/api/upload",{method:"POST",body:l})}async function ys(s,l={}){const{maxWidth:n=1920,maxHeight:p=1920,quality:f=.8,checkOrientation:v=!0,retainExif:g=!1,mimeType:j,convertTypes:k=["image/png"],convertSize:K=5*1024*1024,keepOriginalFormat:O=!1}=l;let $=j||"auto";return O&&!j&&(s.type==="image/png"?$="image/png":s.type==="image/webp"?$="image/webp":$="image/jpeg"),new Promise((F,C)=>{new jt(s,{quality:f,maxWidth:n,maxHeight:p,checkOrientation:v,retainExif:g,mimeType:$,convertTypes:k,convertSize:K,success(B){const R=new File([B],s.name,{type:B.type||s.type,lastModified:Date.now()});F(R)},error(B){console.error("图片压缩失败:",B),C(B)}})})}function qe(s,l=1024*1024){return!(!s.type.startsWith("image/")||s.size<=l)}async function _s(s,l={}){const n=[];for(const p of s)if(qe(p))try{const f=await ys(p,l),v=new File([f],p.name,{type:f.type});n.push(v)}catch(f){console.warn(`压缩图片 ${p.name} 失败:`,f),n.push(p)}else n.push(p);return n}const xs={class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-50/50 to-slate-50 dark:from-slate-900 dark:via-slate-900/50 dark:to-slate-900"},bs={class:"max-w-3xl mx-auto px-4 py-6 space-y-4"},ws={key:0,class:"mb-4 p-3 text-sm text-destructive bg-destructive/10 border border-destructive/20 rounded-lg animate-fade-in"},ks={class:"space-y-2"},$s={class:"space-y-2"},Cs={class:"flex flex-wrap gap-2"},Ps={key:1,class:"flex items-center gap-2"},Vs={key:0,class:"flex flex-wrap gap-2 items-center"},Bs=["onClick"],js={class:"space-y-3"},Us={class:"flex items-center gap-2"},Ts={class:"cursor-pointer"},Ds={class:"flex items-center gap-2"},Ms={class:"relative group aspect-square rounded-lg overflow-hidden bg-slate-50 border border-slate-200 dark:bg-slate-800 dark:border-slate-700 cursor-move"},zs=["src","alt"],As={key:1,class:"w-full h-full flex flex-col items-center justify-center bg-slate-200 dark:bg-slate-700 relative"},Ls=["src"],Os={class:"text-xs text-slate-500 dark:text-slate-400 px-2 text-center truncate w-full"},Rs=["onClick"],Ss={class:"absolute bottom-1 left-1 px-1.5 py-0.5 rounded bg-black/60 text-white text-xs"},Fs={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Es={class:"flex flex-wrap gap-2"},Is={class:"ml-auto"},Ns={key:0,class:"pt-2 border-t border-border/50"},Ws={class:"flex flex-wrap gap-2"},Hs={key:0,class:"mr-1"},Ks={key:0},Gs={key:1},qs={class:"pl-14 text-sm muted mb-2"},Ys={key:3,class:"mt-4 flex justify-center"},Ue=10,sl=L({__name:"index",setup(s){const l=T([]),n=T(!0),p=T(""),f=T(null),v=T(),g=T(),j=T(""),k=T([]),K=T(!1),O=T([]),$=T([]),F=T(["旅游","美食","约会","购物","电影","运动","学习","工作","休息","惊喜","纪念日","日常","开心","感动"]),C=T(!1),B=T(""),R=T(null),U=T(""),G=T(!1);async function X(){n.value=!0;try{const c=await re(`/api/daily?take=${Ue}`);l.value=c.items}catch(c){console.error("加载日常记录失败:",c)}finally{n.value=!1}}We(X);async function ee(){if(p.value){U.value="",G.value=!0;try{let c=[];if(f.value?.files&&f.value.files.length){const o=Array.from(f.value.files),z=await _s(o,{maxWidth:1920,maxHeight:1920,quality:.8,checkOrientation:!0,retainExif:!1,convertTypes:["image/png"],convertSize:5*1024*1024,keepOriginalFormat:!1});c=(await gs(z)).urls.map(w=>typeof w=="string"?w:w.url)}await Rt({content:p.value,mediaUrls:c,tags:$.value}),p.value="",$.value=[],C.value=!1,B.value="",k.value.forEach(o=>{o.url&&URL.revokeObjectURL(o.url)}),k.value=[],f.value&&(f.value.value=""),await X()}catch(c){U.value=c?.friendlyMessage||Dt(c),U.value.includes("情侣"),console.error("发布日常记录失败:",c)}finally{G.value=!1}}}function te(c){return Array.isArray(c)?c:[]}const ae=Y(()=>{const c=v.value?v.value.toDate(se()):null,o=g.value?g.value.toDate(se()):null,z=j.value.trim();return l.value.filter(u=>{const w=new Date(u.createdAt);if(c&&w<c||o&&w>new Date(o.getTime()+1440*60*1e3-1)||z&&!(Array.isArray(u.tags)?u.tags:[]).some(H=>String(H).includes(z)))return!1;if(O.value.length){const V=Array.isArray(u.tags)?u.tags:[];if(!O.value.some(I=>V.includes(I)))return!1}return!0})}),pe=Y(()=>{const c=new Date,o=new Date(c.getFullYear(),c.getMonth(),c.getDate()).getTime(),z=new Date(o-(c.getDay()||6)*24*60*60*1e3).getTime(),u=[],w=[],V=[];for(const I of ae.value){const ne=new Date(I.createdAt).getTime();ne>=o?u.push(I):ne>=z?w.push(I):V.push(I)}const H=[];return u.length&&H.push({label:"今天",items:u}),w.length&&H.push({label:"本周",items:w}),V.length&&H.push({label:"更早",items:V}),H}),ve=Y(()=>l.value.length>0&&l.value.length%Ue===0);async function xe(){if(l.value.length){K.value=!0;try{const c=l.value[l.value.length-1],z=(await re(`/api/daily?take=${Ue}&cursor=${encodeURIComponent(c.id)}`)).items.filter(u=>!l.value.find(w=>w.id===u.id));l.value=l.value.concat(z)}catch(c){console.error("加载更多失败:",c)}finally{K.value=!1}}}async function be(){if(!f.value?.files||!f.value.files.length)return;const c=Array.from(f.value.files),o=new Set(k.value.map(V=>`${V.name}-${V.size}`)),z=c.filter(V=>{const H=`${V.name}-${V.size}`;return!o.has(H)});if(z.length===0)return;const w=z.filter(V=>V.type.startsWith("image/")).filter(V=>qe(V));w.length>0&&console.log(`将压缩 ${w.length} 张图片以优化上传速度`),z.forEach(V=>{const H={file:V,name:V.name,type:V.type,size:V.size,url:""};if(V.type.startsWith("image/"))H.url=URL.createObjectURL(V),k.value.push(H);else if(V.type.startsWith("video/")){const I=document.createElement("video");I.preload="metadata";const ne=URL.createObjectURL(V);I.src=ne,H.url=ne;const Ae=k.value.length;k.value.push(H),I.onloadedmetadata=()=>{I.currentTime=.1},I.onseeked=()=>{const ie=document.createElement("canvas");ie.width=I.videoWidth||400,ie.height=I.videoHeight||300;const Le=ie.getContext("2d");Le&&(Le.drawImage(I,0,0,ie.width,ie.height),k.value[Ae]&&(k.value[Ae].url=ie.toDataURL()),URL.revokeObjectURL(ne))},I.onerror=()=>{URL.revokeObjectURL(ne)}}else k.value.push(H)}),le()}function le(){if(!f.value)return;const c=new DataTransfer;k.value.forEach(o=>{c.items.add(o.file)}),f.value.files=c.files}function we(c){k.value[c]?.url&&URL.revokeObjectURL(k.value[c].url),k.value.splice(c,1),le()}function he(){le()}async function ke(c){await X()}async function $e(c){const o=l.value.findIndex(z=>z.id===c);o>=0&&l.value.splice(o,1)}const oe=Y(()=>{const c=new Set;for(const o of l.value){const z=Array.isArray(o.tags)?o.tags:[];for(const u of z)c.add(u)}return Array.from(c)});function ge(c){const o=O.value.indexOf(c);o>=0?O.value.splice(o,1):O.value.push(c)}function Ce(c){const o=$.value.indexOf(c);o>=0?$.value.splice(o,1):$.value.push(c)}function Pe(c){const o=$.value.indexOf(c);o>=0&&$.value.splice(o,1)}function fe(){const c=B.value.trim();if(!c){m();return}$.value.includes(c)||$.value.push(c),F.value.includes(c)||F.value.push(c),B.value="",C.value=!1}function y(){C.value=!0,Mt(()=>{R.value?.focus()})}function m(){C.value=!1,B.value=""}function b(){setTimeout(()=>{B.value.trim()?fe():m()},200)}function P(c){const o=me(se());if(c===0)v.value=o,g.value=o;else{const z=o.subtract({days:c-1});v.value=z,g.value=o}}function E(){v.value=void 0,g.value=void 0,j.value="",O.value=[]}return(c,o)=>{const z=Ut;return t(),d("div",xs,[i(zt),a("div",bs,[i(e(Te),null,{default:r(()=>[i(e(De),{class:"px-4"},{default:r(()=>[U.value?(t(),d("div",ws,[x(h(U.value)+" ",1),U.value.includes("情侣")?(t(),_(z,{key:0,to:"/user/couple",class:"underline ml-1 font-medium hover:opacity-80"},{default:r(()=>[...o[8]||(o[8]=[x("去绑定",-1)])]),_:1})):D("",!0)])):D("",!0),a("form",{class:"flex flex-col gap-4",onSubmit:Z(ee,["prevent"])},[a("div",ks,[i(e(Se),{for:"content"},{default:r(()=>[...o[9]||(o[9]=[x("记录内容",-1)])]),_:1}),i(e(Ot),{id:"content",modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=u=>p.value=u),placeholder:"今天想记录点什么…",class:"min-h-[100px]"},null,8,["modelValue"])]),a("div",$s,[i(e(Se),null,{default:r(()=>[...o[10]||(o[10]=[x("选择标签",-1)])]),_:1}),a("div",Cs,[(t(!0),d(A,null,N(F.value,u=>(t(),_(e(ue),{key:u,variant:"outline",class:_e(["cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors",$.value.includes(u)?"bg-primary text-primary-foreground":""]),onClick:w=>Ce(u)},{default:r(()=>[x(h(u),1)]),_:2},1032,["class","onClick"]))),128)),C.value?(t(),d("div",Ps,[i(e(ye),{ref_key:"customTagInputRef",ref:R,modelValue:B.value,"onUpdate:modelValue":o[1]||(o[1]=u=>B.value=u),type:"text",placeholder:"输入标签名称",maxlength:"10",class:"h-8 w-32",onKeyup:[ce(fe,["enter"]),ce(m,["esc"])],onBlur:b},null,8,["modelValue"]),i(e(S),{type:"button",size:"sm",variant:"default",class:"h-8 px-3",onClick:fe},{default:r(()=>[...o[12]||(o[12]=[x(" 添加 ",-1)])]),_:1}),i(e(S),{type:"button",size:"sm",variant:"outline",class:"h-8 px-3",onClick:m},{default:r(()=>[...o[13]||(o[13]=[x(" 取消 ",-1)])]),_:1})])):(t(),_(e(ue),{key:0,variant:"outline",class:"cursor-pointer hover:bg-muted",onClick:y},{default:r(()=>[...o[11]||(o[11]=[a("span",{class:"mr-1"},"+",-1),a("span",null,"自定义",-1)])]),_:1}))]),$.value.length>0?(t(),d("div",Vs,[o[15]||(o[15]=a("span",{class:"text-xs text-muted-foreground"},"已选：",-1)),(t(!0),d(A,null,N($.value,u=>(t(),_(e(ue),{key:u,class:"gap-1 pr-1"},{default:r(()=>[x(h(u)+" ",1),a("button",{type:"button",class:"ml-1 p-0.5 rounded-full bg-white/80 hover:bg-white text-gray-600 hover:text-gray-800 transition-colors",onClick:w=>Pe(u),title:"删除标签"},[...o[14]||(o[14]=[a("svg",{class:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Bs)]),_:2},1024))),128))])):D("",!0)]),a("div",js,[a("div",Us,[i(e(S),{variant:"outline","as-child":"",class:"flex-1"},{default:r(()=>[a("label",Ts,[a("input",{ref_key:"fileRef",ref:f,type:"file",accept:"image/*,video/*",multiple:"",class:"hidden",onChange:be},null,544),a("div",Ds,[o[16]||(o[16]=a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),o[17]||(o[17]=a("span",null,"添加图片/视频",-1)),k.value.length>0?(t(),_(e(ue),{key:0,variant:"secondary",class:"ml-auto"},{default:r(()=>[x(h(k.value.length),1)]),_:1})):D("",!0)])])]),_:1}),i(e(S),{type:"submit",class:"flex-1",disabled:G.value},{default:r(()=>[x(h(G.value?"发布中...":"发布"),1)]),_:1},8,["disabled"])]),k.value.length>0?(t(),_(e(Tt),{key:0,modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=u=>k.value=u),animation:200,"item-key":u=>`${u.name}-${u.size}`,class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3",onEnd:he},{item:r(({element:u,index:w})=>[a("div",Ms,[u.type.startsWith("image/")?(t(),d("img",{key:0,src:u.url,alt:u.name,class:"w-full h-full object-cover"},null,8,zs)):u.type.startsWith("video/")?(t(),d("div",As,[u.url&&u.url.startsWith("data:image")?(t(),d("img",{key:0,src:u.url,class:"w-full h-full object-cover",alt:"视频预览"},null,8,Ls)):(t(),d(A,{key:1},[o[18]||(o[18]=a("svg",{class:"w-12 h-12 text-slate-400 dark:text-slate-500 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)),a("span",Os,h(u.name),1)],64)),o[19]||(o[19]=a("div",{class:"absolute inset-0 flex items-center justify-center bg-black/20"},[a("svg",{class:"w-10 h-10 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[a("path",{d:"M8 5v14l11-7z"})])],-1))])):D("",!0),a("button",{type:"button",class:"absolute top-1 right-1 w-6 h-6 rounded-full bg-black/60 hover:bg-black/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition z-10",onClick:Z(V=>we(w),["stop"]),title:"删除"},[...o[20]||(o[20]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Rs),a("div",Ss,h(u.type.startsWith("image/")?"图片":"视频"),1)])]),_:1},8,["modelValue","item-key"])):D("",!0)])],32)]),_:1})]),_:1}),i(e(Te),null,{default:r(()=>[i(e(De),{class:"px-4 space-y-4"},{default:r(()=>[a("div",Fs,[i(Ne,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=u=>v.value=u),placeholder:"起始时间",class:"h-9"},null,8,["modelValue"]),i(Ne,{modelValue:g.value,"onUpdate:modelValue":o[4]||(o[4]=u=>g.value=u),placeholder:"结束时间",class:"h-9"},null,8,["modelValue"])]),a("div",Es,[i(e(S),{variant:"outline",size:"sm",onClick:o[5]||(o[5]=u=>P(0)),class:"h-9 px-3"},{default:r(()=>[...o[21]||(o[21]=[a("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})],-1),x(" 今天 ",-1)])]),_:1}),i(e(S),{variant:"outline",size:"sm",onClick:o[6]||(o[6]=u=>P(7)),class:"h-9 px-3"},{default:r(()=>[...o[22]||(o[22]=[a("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),x(" 近7天 ",-1)])]),_:1}),i(e(S),{variant:"outline",size:"sm",onClick:o[7]||(o[7]=u=>P(30)),class:"h-9 px-3"},{default:r(()=>[...o[23]||(o[23]=[a("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),x(" 近30天 ",-1)])]),_:1}),a("div",Is,[i(e(S),{variant:"ghost",size:"sm",onClick:E,class:"h-9 px-3 text-muted-foreground hover:text-foreground"},{default:r(()=>[...o[24]||(o[24]=[a("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])]),_:1})])]),oe.value.length>0?(t(),d("div",Ns,[a("div",Ws,[(t(!0),d(A,null,N(oe.value,u=>(t(),_(e(ue),{key:u,variant:"outline",class:_e(["cursor-pointer transition-all duration-200 hover:shadow-sm",O.value.includes(u)?"bg-primary text-primary-foreground shadow-sm border-primary/50":"hover:bg-muted/50 hover:border-muted-foreground/30"]),onClick:w=>ge(u)},{default:r(()=>[O.value.includes(u)?(t(),d("span",Hs,"✓")):D("",!0),x(" "+h(u),1)]),_:2},1032,["class","onClick"]))),128))])])):D("",!0)]),_:1})]),_:1}),n.value?(t(),d("div",Ks,[i(Lt,{count:3})])):l.value.length===0?(t(),d("div",Gs,[i(At,{text:"暂无日常记录",img:"/assets/images/xiaojimao/xiaojimao-4.png","cta-text":"去发布一条","cta-to":"/daily"})])):(t(),_(Ra,{key:2},{default:r(()=>[(t(!0),d(A,null,N(pe.value,u=>(t(),d(A,{key:u.label},[a("div",qs,h(u.label),1),(t(!0),d(A,null,N(u.items,w=>(t(),_(Ia,{key:w.id},{default:r(()=>[i(Ma,{id:w.id,content:w.content,createdAt:w.createdAt,"media-urls":te(w.mediaUrls),"comment-count":w.commentCount||0,tags:w.tags||[],authorId:w.authorId||w.author?.id,onCommented:V=>ke(w.id),onDeleted:V=>$e(w.id)},null,8,["id","content","createdAt","media-urls","comment-count","tags","authorId","onCommented","onDeleted"])]),_:2},1024))),128))],64))),128))]),_:1})),ve.value&&!n.value?(t(),d("div",Ys,[i(e(S),{variant:"outline",onClick:xe,disabled:K.value},{default:r(()=>[x(h(K.value?"加载中…":"加载更多"),1)]),_:1},8,["disabled"])])):D("",!0)])])}}});export{sl as default};
