import{d as S,r as l,E as G,c as I,w as P,o as K,l as q,a as o,g as m,f as e,u as b,b as T,m as J,F as A,P as O,au as W,D as U,t as x,h,T as $,s as Q,i as d,n as X,K as Y,G as Z,_ as ee,e as a,q as z,x as te}from"./DW3SVq1p.js";import{D as se,u as ae,g as le,h as oe}from"./Cv5foL5a.js";import{u as re}from"./BtuGZPzd.js";import{u as ne}from"./CtS6q3jl.js";const ie={class:"min-h-screen bg-slate-50 dark:bg-slate-900"},de={class:"max-w-2xl mx-auto px-4 py-8"},ue={class:"card space-y-4"},ce={key:0,class:"flex items-center gap-4"},fe={class:"relative group"},ve=["src"],me={class:"flex-1"},be={class:"flex items-center gap-2"},xe=["disabled"],pe=["disabled"],ke={key:1,class:"font-medium flex items-center gap-2"},ge={class:"text-sm text-slate-500 dark:text-slate-400"},he={class:"p-6"},_e={class:"flex items-center justify-between mb-4"},ye=["disabled"],we={class:"mb-4 flex justify-center"},Ce={class:"relative"},Ne=["src"],Me={class:"flex gap-3"},je=["disabled"],Ae=["disabled"],Be={class:"border-t border-slate-200 dark:border-slate-700 pt-4 space-y-3"},Re={key:0,class:"flex items-center justify-between"},Te={class:"flex items-center gap-3"},Ue={class:"text-sm"},ze={class:"font-mono"},De={class:"flex -space-x-3"},Fe=["src"],Le={key:1,class:"text-sm text-slate-500 dark:text-slate-400"},Ve={class:"font-mono"},Ee={key:1,class:"text-sm text-slate-500 dark:text-slate-400"},He={class:"flex items-center gap-3 text-sm pt-2"},Se=S({__name:"index",setup(Ge){const N=l(null),u=l(null),_=l(!1),c=l(""),M=l(null),f=l(!1),y=l(!1),n=l(!1),p=l(null),j=l(null),B=l(null),w=ne(),k=G(),v=I(()=>k.user),{data:D}=re();P(D,s=>{s?.couple!==void 0&&(u.value=s.couple)},{immediate:!0}),K(async()=>{}),q(B,()=>{y.value&&!n.value&&g()});function F(s){const r=s.target.files?.[0];if(r){if(!r.type.startsWith("image/")){alert("请选择图片文件");return}if(r.size>5*1024*1024){alert("图片大小不能超过 5MB");return}p.value=r;const i=new FileReader;i.onload=H=>{j.value=H.target?.result},i.readAsDataURL(r)}}function g(){y.value=!1,n.value=!1,p.value=null,j.value=null,N.value&&(N.value.value="")}async function L(){if(p.value){n.value=!0;try{await oe(p.value),g(),w.success("头像上传成功！")}catch(s){console.error("上传头像失败:",s),w.error(s?.friendlyMessage||"上传头像失败，请稍后再试")}finally{n.value=!1}}}function V(){k.user&&(c.value=k.user.nickName,_.value=!0,Y(()=>{M.value?.focus(),M.value?.select()}))}function C(){_.value=!1,c.value=""}async function R(){if(f.value||!k.user)return;const s=c.value.trim();if(!s){C();return}if(s===k.user.nickName){C();return}f.value=!0;try{await ae(s),_.value=!1,c.value="",w.success("昵称修改成功！")}catch(t){w.error(t?.friendlyMessage||"修改昵称失败，请稍后再试")}finally{f.value=!1}}async function E(){try{await le(),Z("/user/login")}catch(s){console.error("退出登录失败:",s)}}return(s,t)=>{const r=ee;return a(),o("div",ie,[m(se,{"user-override":b(v)},null,8,["user-override"]),e("div",de,[e("div",ue,[t[16]||(t[16]=e("div",{class:"text-lg"},"用户资料",-1)),b(v)?(a(),o("div",ce,[e("div",fe,[e("img",{src:b(v).avatarUrl||"/assets/images/xiaobai/xiaobai-2.png",loading:"lazy",class:"w-16 h-16 rounded-full object-cover"},null,8,ve),e("button",{class:"absolute inset-0 w-16 h-16 rounded-full bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",onClick:t[0]||(t[0]=i=>y.value=!0),title:"修改头像"},[...t[2]||(t[2]=[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])])]),e("div",me,[e("div",be,[_.value?(a(),o(A,{key:0},[O(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>c.value=i),ref_key:"nicknameInputRef",ref:M,type:"text",maxlength:"20",class:"border border-slate-200 dark:border-slate-700 rounded px-2 py-1 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-600 dark:focus:ring-amber-500 flex-1",onKeyup:[U(R,["enter"]),U(C,["esc"])]},null,544),[[W,c.value]]),e("button",{class:"px-2 py-1 text-xs rounded bg-amber-600 text-white hover:bg-amber-700 dark:bg-amber-500 dark:hover:bg-amber-600 transition",onClick:R,disabled:f.value},x(f.value?"保存中...":"保存"),9,xe),e("button",{class:"px-2 py-1 text-xs rounded bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 transition",onClick:C,disabled:f.value}," 取消 ",8,pe)],64)):(a(),o("div",ke,[e("span",null,x(b(v).nickName),1),e("button",{class:"text-xs text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-slate-300 ml-1 transition p-0.5",onClick:V,title:"点击编辑昵称"},[...t[3]||(t[3]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])])]))]),e("div",ge,x(b(v).email),1)])])):T("",!0),(a(),J(Q,{to:"body"},[m($,{name:"fade"},{default:h(()=>[y.value?(a(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:z(g,["self"])},[e("div",{ref_key:"avatarModalRef",ref:B,class:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-md w-full mx-4 overflow-hidden"},[e("div",he,[e("div",_e,[t[5]||(t[5]=e("h3",{class:"text-lg font-semibold"},"修改头像",-1)),e("button",{class:"text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-slate-300 transition",onClick:g,disabled:n.value},[...t[4]||(t[4]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ye)]),e("div",we,[e("div",Ce,[e("img",{src:j.value||b(v)?.avatarUrl||"/assets/images/xiaobai/xiaobai-2.png",class:"w-32 h-32 rounded-full object-cover border-2 border-slate-200 dark:border-slate-700",alt:"头像预览"},null,8,Ne)])]),e("form",{onSubmit:z(L,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{class:"block mb-2 text-sm text-slate-600 dark:text-slate-400"},"选择图片",-1)),e("input",{ref_key:"fileRef",ref:N,type:"file",accept:"image/*",class:"block w-full text-sm text-slate-600 dark:text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-amber-600 file:text-white hover:file:bg-amber-700 dark:file:bg-amber-500 dark:hover:file:bg-amber-600 file:cursor-pointer cursor-pointer",onChange:F},null,544),t[7]||(t[7]=e("p",{class:"mt-1 text-xs text-slate-400 dark:text-slate-500"},"支持 JPG、PNG、GIF 格式，建议尺寸 200x200 像素",-1))]),e("div",Me,[e("button",{type:"button",class:"flex-1 px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 transition text-sm",onClick:g,disabled:n.value}," 取消 ",8,je),e("button",{type:"submit",class:"flex-1 px-4 py-2 rounded-lg bg-amber-600 text-white hover:bg-amber-700 dark:bg-amber-500 dark:hover:bg-amber-600 transition text-sm",disabled:n.value||!p.value},x(n.value?"上传中...":"上传"),9,Ae)])],32)])],512)])):T("",!0)]),_:1})])),e("div",Be,[t[14]||(t[14]=e("div",{class:"text-base"},"情侣关系",-1)),u.value?(a(),o(A,{key:0},[u.value.members?.length>=2?(a(),o("div",Re,[e("div",Te,[e("div",Ue,[t[8]||(t[8]=d("邀请码：",-1)),e("span",ze,x(u.value.code),1)]),e("div",De,[(a(!0),o(A,null,X(u.value.members,i=>(a(),o("img",{key:i.id,src:i.avatarUrl||"/assets/images/couple/couple-2.png",class:"w-8 h-8 rounded-full border-2 border-white"},null,8,Fe))),128))])]),m(r,{to:"/user/couple",class:"text-sm underline"},{default:h(()=>[...t[9]||(t[9]=[d("管理情侣",-1)])]),_:1})])):(a(),o("div",Le,[t[11]||(t[11]=d(" 已创建情侣但尚未完成绑定，邀请码：",-1)),e("span",Ve,x(u.value.code),1),m(r,{to:"/user/couple",class:"underline ml-1"},{default:h(()=>[...t[10]||(t[10]=[d("去邀请对方",-1)])]),_:1})]))],64)):(a(),o("div",Ee,[t[13]||(t[13]=d("你还没有绑定情侣。 ",-1)),m(r,{to:"/user/couple",class:"underline ml-1"},{default:h(()=>[...t[12]||(t[12]=[d("去绑定",-1)])]),_:1})]))]),e("div",He,[m(r,{to:"/",class:"underline"},{default:h(()=>[...t[15]||(t[15]=[d("返回首页",-1)])]),_:1}),e("button",{class:"underline",onClick:E},"退出登录")])])])])}}}),Je=te(Se,[["__scopeId","data-v-6dcfb87c"]]);export{Je as default};
