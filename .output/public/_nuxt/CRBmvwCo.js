import{d as E,r as x,c as v,E as H,o as P,a as o,g as F,f as t,b as g,i as I,t as n,F as q,n as z,q as h,P as _,au as w,e as l,G as k}from"./DW3SVq1p.js";import{D as G}from"./Cv5foL5a.js";import{u as L,c as J,j as K,s as O}from"./BtuGZPzd.js";const Q={class:"min-h-screen bg-slate-50 dark:bg-slate-900"},R={class:"max-w-xl mx-auto px-4 py-8"},W={class:"card space-y-4"},X={key:0,class:"text-sm text-slate-500 dark:text-slate-400"},Y={key:1,class:"space-y-4"},Z={class:"flex items-center justify-between"},ee={class:"font-mono"},te={class:"space-y-3"},se=["src","alt"],ae={class:"flex-1 min-w-0"},oe={class:"flex items-center gap-2 mb-1"},le={class:"font-medium text-slate-900 dark:text-slate-100"},ne={class:"text-xs text-slate-400 dark:text-slate-500"},re={key:0,class:"flex items-center gap-2 mb-2"},ie={class:"px-2 py-0.5 rounded-full bg-slate-200 text-slate-600 dark:bg-slate-700 dark:text-slate-400 text-sm"},ce={key:0,class:"text-xs text-slate-400 dark:text-slate-500"},de={key:1,class:"text-xs text-slate-400 dark:text-slate-500 mb-2"},ue={class:"flex items-center gap-2"},pe=["onClick"],fe={key:0,class:"space-y-2"},xe={key:2,class:"space-y-4"},ve={class:"flex flex-col sm:flex-row gap-3 items-start sm:items-center"},he=E({__name:"couple",setup(me){const i=x(""),c=x(""),d=x(!1),{data:C,pending:T,refresh:u}=L(),r=v(()=>C.value?.couple||null),M=v(()=>T.value),$=H(),m=v(()=>$.user?.id||null);function D(s){if(!s)return"";const e=new Date(s),p=new Date().getTime()-e.getTime(),f=Math.floor(p/6e4),y=Math.floor(p/36e5),b=Math.floor(p/864e5);if(f<1)return"刚刚";if(f<60)return`${f}分钟前`;if(y<24)return`${y}小时前`;if(b<7)return`${b}天前`;const V=e.getMonth()+1,B=e.getDate();return`${V}月${B}日`}P(async()=>{await u()});async function j(){try{await J(),await u()}catch(s){console.error("创建情侣失败:",s),alert(s?.friendlyMessage||"创建情侣失败，请稍后再试")}}async function A(){if(i.value)try{await K(i.value),i.value="",await u()}catch(s){console.error("加入情侣失败:",s),alert(s?.friendlyMessage||"加入情侣失败，请检查邀请码是否正确")}}async function N(){if(!r.value?.code)return;const s=r.value.code;try{if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(s),d.value=!0,setTimeout(()=>{d.value=!1},2e3);return}}catch(e){console.warn("Clipboard API 失败，使用降级方案:",e)}try{const e=document.createElement("textarea");e.value=s,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();const a=document.execCommand("copy");document.body.removeChild(e),a?(d.value=!0,setTimeout(()=>{d.value=!1},2e3)):alert(`邀请码：${s}

请手动复制`)}catch(e){console.error("复制失败:",e),alert(`邀请码：${s}

请手动复制`)}}async function S(){if(c.value)try{await O(c.value),c.value="",await u()}catch(s){console.error("切换情侣失败:",s),alert(s?.friendlyMessage||"切换情侣失败，请检查邀请码是否正确")}}async function U(s,e){e?await k("/user/profile"):await k(`/user/profile/${s}`)}return(s,e)=>(l(),o("div",Q,[F(G),t("div",R,[t("div",W,[e[7]||(e[7]=t("div",{class:"text-lg"},"情侣绑定",-1)),M.value?(l(),o("div",X,"加载中…")):r.value?(l(),o("div",Y,[t("div",Z,[t("div",null,[e[2]||(e[2]=I("邀请码：",-1)),t("span",ee,n(r.value.code),1)]),t("button",{class:"btn-secondary text-xs",onClick:N},n(d.value?"已复制":"复制"),1)]),t("div",te,[(l(!0),o(q,null,z(r.value.members,a=>(l(),o("div",{key:a.id,class:"flex items-start gap-3 p-3 rounded-lg bg-slate-50 hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700 transition"},[t("img",{src:a.avatarUrl||"/assets/images/xiaojimao/xiaojimao-2.png",alt:a.nickName,loading:"lazy",class:"w-12 h-12 rounded-full border-2 border-white object-cover flex-shrink-0"},null,8,se),t("div",ae,[t("div",oe,[t("span",le,n(a.nickName),1),t("span",ne,"（"+n(a.role==="A"?"发起者":"伴侣")+"）",1)]),a.status?(l(),o("div",re,[t("span",ie,n(a.status),1),a.statusUpdatedAt?(l(),o("span",ce,n(D(a.statusUpdatedAt)),1)):g("",!0)])):(l(),o("div",de,"暂无状态")),t("div",ue,[t("button",{onClick:p=>U(a.id,a.id===m.value),class:"text-xs text-amber-600 hover:text-amber-700 dark:text-amber-500 dark:hover:text-amber-400 underline"},n(a.id===m.value?"查看我的主页":"查看主页"),9,pe)])])]))),128))]),r.value.members.length===1?(l(),o("div",fe,[e[4]||(e[4]=t("div",{class:"text-xs text-slate-500 dark:text-slate-400"},"已创建情侣：等待对方加入。你也可以直接加入对方的情侣（将切换绑定）。",-1)),t("form",{class:"flex gap-2",onSubmit:h(S,["prevent"])},[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),placeholder:"输入对方的邀请码切换绑定",class:"input"},null,512),[[w,c.value]]),e[3]||(e[3]=t("button",{class:"btn-secondary"},"切换加入",-1))],32)])):g("",!0)])):(l(),o("div",xe,[e[6]||(e[6]=t("div",{class:"text-sm text-slate-500 dark:text-slate-400"},"你还没有绑定情侣。可以创建情侣，或直接输入对方的邀请码加入。",-1)),t("div",ve,[t("button",{class:"btn-primary",onClick:j},"创建情侣"),t("form",{class:"flex gap-2 w-full sm:w-auto",onSubmit:h(A,["prevent"])},[_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),placeholder:"输入邀请码（如 ABC123）",class:"input w-full sm:w-56"},null,512),[[w,i.value]]),e[5]||(e[5]=t("button",{class:"btn-secondary"},"加入",-1))],32)])]))])])]))}});export{he as default};
