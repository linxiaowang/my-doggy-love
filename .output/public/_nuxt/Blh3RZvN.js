import{d as V,r as d,a as c,g as s,f as r,h as a,u as t,I as $,e as p,i,b as k,t as _,q as h,_ as D,J as N,K as q,L as E}from"./DW3SVq1p.js";import{D as M,_ as v,l as R}from"./Cv5foL5a.js";import{D as T,_ as B,a as C,b as L}from"./shU-Sxv5.js";import{_ as S,a as y,b as A}from"./DHqhx6bH.js";import{_ as w}from"./BvfOXczi.js";const F={class:"min-h-screen bg-muted/30"},U={class:"max-w-md mx-auto px-4 py-10"},j={key:0,class:"mb-4 p-3 text-sm text-destructive bg-destructive/10 border border-destructive/20 rounded-md"},H={class:"space-y-2"},I={class:"space-y-2"},J={class:"mt-6 flex items-center justify-between"},W=V({__name:"login",setup(K){const x=$(),o=d(""),u=d(""),n=d(!1),l=d("");async function g(){if(l.value="",!o.value.trim()){l.value="请输入邮箱";return}if(!u.value){l.value="请输入密码";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.value.trim())){l.value="邮箱格式不正确";return}n.value=!0;try{await R({email:o.value.trim(),password:u.value}),window.dispatchEvent(new Event("user-login-success"));const m=N().query.redirect||"/";await q(),setTimeout(async()=>{await x.push(m)},100)}catch(e){l.value=e?.friendlyMessage||E(e)}finally{n.value=!1}}return(b,e)=>{const m=D;return p(),c("div",F,[s(M),r("div",U,[s(T,{class:"mb-4"}),s(t(A),null,{default:a(()=>[s(t(B),null,{default:a(()=>[s(t(C),null,{default:a(()=>[...e[2]||(e[2]=[i("登录",-1)])]),_:1}),s(t(L),null,{default:a(()=>[...e[3]||(e[3]=[i("使用邮箱和密码登录",-1)])]),_:1})]),_:1}),s(t(S),null,{default:a(()=>[l.value?(p(),c("div",j,_(l.value),1)):k("",!0),r("form",{class:"space-y-4",onSubmit:h(g,["prevent"])},[r("div",H,[s(t(w),{htmlFor:"email",class:"sr-only"},{default:a(()=>[...e[4]||(e[4]=[i("邮箱",-1)])]),_:1}),s(t(y),{id:"email",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=f=>o.value=f),modelModifiers:{trim:!0},type:"email",placeholder:"邮箱",required:"",autocomplete:"email"},null,8,["modelValue"])]),r("div",I,[s(t(w),{htmlFor:"password",class:"sr-only"},{default:a(()=>[...e[5]||(e[5]=[i("密码",-1)])]),_:1}),s(t(y),{id:"password",modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=f=>u.value=f),modelModifiers:{trim:!0},type:"password",placeholder:"密码",required:"",autocomplete:"current-password"},null,8,["modelValue"])]),s(t(v),{type:"submit",class:"w-full",disabled:n.value||!o.value||!u.value},{default:a(()=>[i(_(n.value?"登录中…":"登录"),1)]),_:1},8,["disabled"])],32),r("div",J,[e[7]||(e[7]=r("span",{class:"text-sm text-muted-foreground"},"还没有账号？",-1)),s(t(v),{variant:"link",class:"p-0 h-auto","as-child":""},{default:a(()=>[s(m,{to:"/user/register"},{default:a(()=>[...e[6]||(e[6]=[i("去注册",-1)])]),_:1})]),_:1})])]),_:1})]),_:1})])])}}});export{W as default};
