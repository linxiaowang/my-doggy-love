import{k as C,d as X,r as m,o as Y,a as i,g as t,f as c,h as r,u as s,F as L,n as M,e as n,b as x,i as f,m as I,t as u,_ as Z,q as U,D as F,L as ee}from"./DW3SVq1p.js";import{D as te,_ as h,b as z,c as K,d as O}from"./Cv5foL5a.js";import{E as ae}from"./BeFyUl0g.js";import{S as se}from"./Cf2i4mGW.js";import{_ as P,b as R,a as q}from"./DHqhx6bH.js";import{_ as oe}from"./-giXuYDd.js";async function ne(p){return C("/api/messages",{method:"POST",body:p})}async function le(p,_){return C(`/api/messages/${p}/comment`,{method:"POST",body:{content:_}})}async function ie(p,_){return C(`/api/messages/comments/${p}/reply`,{method:"POST",body:{content:_}})}const re={class:"min-h-screen bg-gradient-to-br from-#f7f6f3 via-#faf9f7 to-#f7f6f3"},ue={class:"max-w-2xl mx-auto px-4 py-6 space-y-4"},ce={key:0,class:"mb-4 p-3 text-sm text-destructive bg-destructive/10 border border-destructive/20 rounded-lg"},de={key:0},me={key:1},fe={key:2,class:"space-y-3"},ve={class:"flex items-start gap-3"},_e={class:"flex-1 min-w-0"},pe={class:"text-sm text-muted-foreground mb-1.5 font-medium"},xe={class:"text-foreground whitespace-pre-wrap break-words leading-relaxed"},he={class:"mt-3 flex items-center gap-3 text-sm border-t border-border pt-3"},ge={key:0,class:"mt-3 flex items-center gap-2 animate-fade-in"},ye={key:1,class:"mt-2"},ke={key:0,class:"text-sm text-muted-foreground"},be={key:1,class:"text-sm text-muted-foreground"},we={key:2,class:"space-y-2"},Ce={class:"flex items-start gap-2"},$e={class:"flex-1 min-w-0"},Ne={class:"text-xs text-muted-foreground"},Ve={class:"text-sm text-foreground whitespace-pre-wrap break-words"},Se={key:0,class:"mt-1 flex items-center gap-2"},Ae={key:0,class:"pl-8 space-y-1"},De={class:"flex-1 min-w-0"},Le={class:"text-xs text-muted-foreground"},Me={class:"text-sm text-foreground whitespace-pre-wrap break-words"},Ee=X({__name:"index",setup(p){const _=m([]),g=m(""),V=m(!0),y=m(""),v=m(null),k=m(null),S=m([]),A=m(!1),$=m(null),b=m("");function H(e){return e&&e>0?`(${e})`:""}async function T(){V.value=!0;try{const e=await C("/api/messages");_.value=e.items}catch(e){console.error("加载留言失败:",e)}finally{V.value=!1}}Y(T);const w=m(""),N=m(!1);async function j(){if(g.value){w.value="",N.value=!0;try{await ne({content:g.value}),g.value="",await T()}catch(e){w.value=e?.friendlyMessage||ee(e),console.error("发布留言失败:",e)}finally{N.value=!1}}}function G(e){v.value=v.value===e?null:e,v.value===e&&D(e)}async function D(e){A.value=!0;try{const a=await C(`/api/messages/${e}/comments`);S.value=a.items}catch(a){console.error("加载评论失败:",a)}finally{A.value=!1}}function J(e){k.value=k.value===e?null:e}async function B(e){if(y.value)try{await le(e,y.value),y.value="",v.value=e,k.value=null,await D(e)}catch(a){console.error("发布评论失败:",a)}}function Q(e){$.value=$.value===e?null:e}async function E(e){if(b.value)try{await ie(e,b.value),b.value="",v.value&&await D(v.value)}catch(a){console.error("回复评论失败:",a)}}return(e,a)=>{const W=Z;return n(),i("div",re,[t(te),c("div",ue,[t(s(R),null,{default:r(()=>[t(s(P),{class:"px-4"},{default:r(()=>[w.value?(n(),i("div",ce,[f(u(w.value)+" ",1),w.value.includes("情侣")?(n(),I(W,{key:0,to:"/user/couple",class:"underline ml-1 font-medium hover:opacity-80"},{default:r(()=>[...a[3]||(a[3]=[f("去绑定",-1)])]),_:1})):x("",!0)])):x("",!0),c("form",{class:"flex gap-2 items-center",onSubmit:U(j,["prevent"])},[t(s(oe),{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),placeholder:"留下想说的话…",class:"flex-1 min-h-[80px]"},null,8,["modelValue"]),t(s(h),{type:"submit",disabled:N.value},{default:r(()=>[f(u(N.value?"发布中...":"发布"),1)]),_:1},8,["disabled"])],32)]),_:1})]),_:1}),V.value?(n(),i("div",de,[t(se,{count:3})])):_.value.length===0?(n(),i("div",me,[t(ae,{text:"还没有留言",img:"/assets/images/xiaobai/xiaobai-3.png","cta-text":"去发表第一条","cta-to":"/messages"})])):(n(),i("div",fe,[(n(!0),i(L,null,M(_.value,l=>(n(),I(s(R),{key:l.id},{default:r(()=>[t(s(P),{class:"px-4"},{default:r(()=>[c("div",ve,[t(s(z),null,{default:r(()=>[t(s(K),{src:l.author?.avatarUrl||"/assets/images/xiaobai/xiaobai-2.png",alt:l.author?.nickName||"用户头像"},null,8,["src","alt"]),t(s(O),null,{default:r(()=>[f(u((l.author?.nickName||"匿名").charAt(0)),1)]),_:2},1024)]),_:2},1024),c("div",_e,[c("div",pe,u(l.author?.nickName||"匿名")+" · "+u(new Date(l.createdAt).toLocaleString()),1),c("div",xe,u(l.content),1),c("div",he,[t(s(h),{variant:"ghost",size:"sm",onClick:o=>G(l.id)},{default:r(()=>[f(u(v.value===l.id?"收起评论":`查看评论${H(l.commentCount)}`),1)]),_:2},1032,["onClick"]),a[4]||(a[4]=c("span",{class:"text-muted-foreground/30"},"|",-1)),t(s(h),{variant:"ghost",size:"sm",onClick:o=>J(l.id)},{default:r(()=>[f(u(k.value===l.id?"收起输入":"写评论"),1)]),_:2},1032,["onClick"])]),k.value===l.id?(n(),i("div",ge,[t(s(q),{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=o=>y.value=o),placeholder:"写点评论…",class:"flex-1",onKeydown:F(U(o=>B(l.id),["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),t(s(h),{size:"sm",onClick:o=>B(l.id)},{default:r(()=>[...a[5]||(a[5]=[f("发布",-1)])]),_:1},8,["onClick"])])):x("",!0),v.value===l.id?(n(),i("div",ye,[A.value?(n(),i("div",ke,"加载中…")):S.value.length===0?(n(),i("div",be,"暂无评论")):(n(),i("div",we,[(n(!0),i(L,null,M(S.value,o=>(n(),i("div",{key:o.id,class:"space-y-1"},[c("div",Ce,[t(s(z),{class:"w-7 h-7"},{default:r(()=>[t(s(K),{src:o.author?.avatarUrl||"/assets/images/xiaobai/xiaobai-2.png",alt:o.author?.nickName||"用户头像"},null,8,["src","alt"]),t(s(O),{class:"text-xs"},{default:r(()=>[f(u((o.author?.nickName||"匿名").charAt(0)),1)]),_:2},1024)]),_:2},1024),c("div",$e,[c("div",Ne,u(o.author?.nickName||"匿名")+" · "+u(new Date(o.createdAt).toLocaleString()),1),c("div",Ve,u(o.content),1),t(s(h),{variant:"link",size:"sm",class:"h-auto p-0 text-xs",onClick:d=>Q(o.id)},{default:r(()=>[f(u($.value===o.id?"收起回复":"回复"),1)]),_:2},1032,["onClick"]),$.value===o.id?(n(),i("div",Se,[t(s(q),{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=d=>b.value=d),placeholder:"回复…",class:"flex-1 h-8 text-sm",onKeydown:F(U(d=>E(o.id),["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),t(s(h),{size:"sm",class:"h-8",onClick:d=>E(o.id)},{default:r(()=>[...a[6]||(a[6]=[f("发送",-1)])]),_:1},8,["onClick"])])):x("",!0)])]),o.replies?.length?(n(),i("div",Ae,[(n(!0),i(L,null,M(o.replies,d=>(n(),i("div",{key:d.id,class:"flex items-start gap-2"},[t(s(z),{class:"w-6 h-6"},{default:r(()=>[t(s(K),{src:d.author?.avatarUrl,alt:d.author?.nickName||"用户头像"},null,8,["src","alt"]),t(s(O),{class:"text-[10px]"},{default:r(()=>[f(u((d.author?.nickName||"匿名").charAt(0)),1)]),_:2},1024)]),_:2},1024),c("div",De,[c("div",Le,u(d.author?.nickName||"匿名")+" · "+u(new Date(d.createdAt).toLocaleString()),1),c("div",Me,u(d.content),1)])]))),128))])):x("",!0)]))),128))]))])):x("",!0)])])]),_:2},1024)]),_:2},1024))),128))]))])])}}});export{Ee as default};
