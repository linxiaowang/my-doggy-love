import{d as D,a2 as I,m as B,e as p,h as n,N as M,al as ee,am as te,U as N,u as t,aB as ae,O as L,aC as se,g as l,aD as oe,b as le,aE as ne,f as m,aF as re,aG as ie,a as k,p as U,a6 as de,aH as ue,r as $,o as ce,F as fe,n as me,k as pe,q as Y,i as x,t as H,j as S}from"./DW3SVq1p.js";import{e as z,D as ge,_ as T,a as ve}from"./Cv5foL5a.js";import{E as _e}from"./BeFyUl0g.js";import{S as ye}from"./Cf2i4mGW.js";import{_ as R,a as A,b as q}from"./DHqhx6bH.js";import{_ as G}from"./BvfOXczi.js";import{c as he,d as we,a as $e}from"./Bb-vy0QT.js";const xe=D({__name:"Dialog",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(f,{emit:d}){const _=I(f,d);return(y,b)=>(p(),B(t(ae),N({"data-slot":"dialog"},t(_)),{default:n(w=>[M(y.$slots,"default",ee(te(w)))]),_:3},16))}}),be=D({__name:"DialogOverlay",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(f){const d=f,u=L(d,"class");return(c,_)=>(p(),B(t(se),N({"data-slot":"dialog-overlay"},t(u),{class:t(z)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",d.class)}),{default:n(()=>[M(c.$slots,"default")]),_:3},16,["class"]))}}),ke=D({inheritAttrs:!1,__name:"DialogContent",props:{forceMount:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{},class:{},showCloseButton:{type:Boolean,default:!0}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(f,{emit:d}){const u=f,c=d,_=L(u,"class"),y=I(_,c);return(b,w)=>(p(),B(t(ie),null,{default:n(()=>[l(be),l(t(oe),N({"data-slot":"dialog-content"},{...b.$attrs,...t(y)},{class:t(z)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",u.class)}),{default:n(()=>[M(b.$slots,"default"),f.showCloseButton?(p(),B(t(ne),{key:0,"data-slot":"dialog-close",class:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"},{default:n(()=>[l(t(re)),w[0]||(w[0]=m("span",{class:"sr-only"},"Close",-1))]),_:1})):le("",!0)]),_:3},16,["class"])]),_:3}))}}),De=D({__name:"DialogFooter",props:{class:{}},setup(f){const d=f;return(u,c)=>(p(),k("div",{"data-slot":"dialog-footer",class:U(t(z)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",d.class))},[M(u.$slots,"default")],2))}}),Ce=D({__name:"DialogHeader",props:{class:{}},setup(f){const d=f;return(u,c)=>(p(),k("div",{"data-slot":"dialog-header",class:U(t(z)("flex flex-col gap-2 text-center sm:text-left",d.class))},[M(u.$slots,"default")],2))}}),Be=D({__name:"DialogTitle",props:{asChild:{type:Boolean},as:{},class:{}},setup(f){const d=f,u=L(d,"class"),c=de(u);return(_,y)=>(p(),B(t(ue),N({"data-slot":"dialog-title"},t(c),{class:t(z)("text-lg leading-none font-semibold",d.class)}),{default:n(()=>[M(_.$slots,"default")]),_:3},16,["class"]))}}),Me={class:"min-h-screen bg-slate-50 dark:bg-slate-900"},Ve={class:"max-w-3xl mx-auto px-4 py-6 space-y-4"},Fe={class:"flex-1 md:flex-[2]"},Pe={class:"flex-1"},Te={key:0},ze={key:1},Ee={key:2,class:"grid md:grid-cols-2 gap-4"},Oe={class:"flex items-start justify-between gap-3 mb-4"},Se={class:"flex-1"},Ae={class:"font-semibold text-lg mb-1"},Ue={class:"text-sm text-muted-foreground"},Ne={class:"flex items-center gap-2"},je={class:"space-y-2"},He={class:"space-y-2"},Xe=D({__name:"index",setup(f){const d=$([]),u=$(""),c=$(""),_=$(!0),y=$(!1),b=$(""),w=$(""),E=$(""),g=$({});function V(s,a,e){const r=Math.abs(s);switch(a){case"years":if(r>=365)if(e){const i=S(),o=S(e),h=Math.abs(i.diff(o,"year")),C=i.isBefore(o)?i:o,F=i.isAfter(o)?i:o,j=C.add(h,"year"),P=Math.abs(F.diff(j,"day"));return P===0?`${h}年`:`${h}年${P}天`}else{const i=Math.floor(r/365),o=r%365;return o===0?`${i}年`:`${i}年${o}天`}return V(s,"months",e);case"months":if(r>=30)if(e){const i=S(),o=S(e),h=Math.abs(i.diff(o,"month")),C=i.isBefore(o)?i:o,F=i.isAfter(o)?i:o,j=C.add(h,"month"),P=Math.abs(F.diff(j,"day"));return P===0?`${h}个月`:`${h}个月${P}天`}else{const i=Math.floor(r/30),o=r%30;return o===0?`${i}个月`:`${i}个月${o}天`}return V(s,"weeks",e);case"weeks":if(r>=7){const i=Math.floor(r/7),o=r%7;return o===0?`${i}周`:`${i}周${o}天`}return V(s,"days",e);case"days":default:return`${r}天`}}function K(s,a){const e=Math.abs(a),r=g.value[s]||"days";e>=365?r==="days"?g.value[s]="weeks":r==="weeks"?g.value[s]="months":r==="months"?g.value[s]="years":g.value[s]="days":e>=30?r==="days"?g.value[s]="weeks":r==="weeks"?g.value[s]="months":g.value[s]="days":e>=7&&(r==="days"?g.value[s]="weeks":g.value[s]="days")}function v(s){const a=new Date,e=new Date(s.date),r=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),i=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime(),o=Math.round((i-r)/(1440*60*1e3)),h=o<0,C=g.value[s.id]||"days",F=o===0?"就是今天":h?`已经 ${V(o,C,s.date)}`:`还有 ${V(o,C,s.date)}`;return{days:o,overdue:h,label:F,canToggle:Math.abs(o)>=7}}async function O(){_.value=!0;try{const s=await pe("/api/anniversaries");d.value=s.items,g.value={}}catch(s){console.error("加载纪念日列表失败:",s)}finally{_.value=!1}}ce(O);async function X(){if(!(!u.value||!c.value))try{await he({title:u.value,date:c.value}),u.value="",c.value="",await O()}catch(s){console.error("创建纪念日失败:",s)}}async function J(s){try{await we(s),await O()}catch(a){console.error("删除纪念日失败:",a)}}function Q(s){b.value=s.id,w.value=s.title,E.value=s.date.slice(0,10),y.value=!0}function W(){y.value=!1}async function Z(){if(b.value)try{await $e(b.value,{title:w.value,date:E.value}),y.value=!1,await O()}catch(s){console.error("更新纪念日失败:",s)}}return(s,a)=>(p(),k("div",Me,[l(ge),m("div",Ve,[l(t(q),null,{default:n(()=>[l(t(R),{class:"px-4"},{default:n(()=>[m("form",{class:"flex flex-col md:flex-row gap-3",onSubmit:Y(X,["prevent"])},[m("div",Fe,[l(t(A),{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),placeholder:"纪念日标题"},null,8,["modelValue"])]),m("div",Pe,[l(t(A),{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),type:"date"},null,8,["modelValue"])]),l(t(T),{type:"submit",class:"md:w-auto"},{default:n(()=>[...a[5]||(a[5]=[x("创建",-1)])]),_:1})],32)]),_:1})]),_:1}),_.value?(p(),k("div",Te,[l(ye,{count:2})])):d.value.length===0?(p(),k("div",ze,[l(_e,{text:"添加一个特别的日子吧",img:"/assets/images/couple/couple-1.png","cta-text":"创建纪念日","cta-to":"/anniversaries"})])):(p(),k("div",Ee,[(p(!0),k(fe,null,me(d.value,e=>(p(),B(t(q),{key:e.id,class:U(v(e).overdue?"border-destructive/30":"border-primary/30")},{default:n(()=>[l(t(R),null,{default:n(()=>[m("div",Oe,[m("div",Se,[m("h3",Ae,H(e.title),1),m("p",Ue,H(new Date(e.date).toLocaleDateString()),1)]),l(t(ve),{variant:v(e).overdue?"destructive":v(e).days===0?"default":"secondary",class:U(v(e).canToggle&&v(e).days!==0?"cursor-pointer hover:opacity-80":""),title:v(e).canToggle&&v(e).days!==0?"点击切换显示格式":"",onClick:r=>v(e).canToggle&&v(e).days!==0?K(e.id,v(e).days):null},{default:n(()=>[x(H(v(e).label),1)]),_:2},1032,["variant","class","title","onClick"])]),m("div",Ne,[l(t(T),{variant:"outline",size:"sm",onClick:r=>Q(e)},{default:n(()=>[...a[6]||(a[6]=[x("编辑",-1)])]),_:1},8,["onClick"]),l(t(T),{variant:"outline",size:"sm",onClick:r=>J(e.id)},{default:n(()=>[...a[7]||(a[7]=[x("删除",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1032,["class"]))),128))])),l(t(xe),{open:y.value,"onUpdate:open":a[4]||(a[4]=e=>y.value=e)},{default:n(()=>[l(t(ke),null,{default:n(()=>[l(t(Ce),null,{default:n(()=>[l(t(Be),null,{default:n(()=>[...a[8]||(a[8]=[x("编辑纪念日",-1)])]),_:1})]),_:1}),m("form",{class:"space-y-4",onSubmit:Y(Z,["prevent"])},[m("div",je,[l(t(G),{for:"edit-title"},{default:n(()=>[...a[9]||(a[9]=[x("标题",-1)])]),_:1}),l(t(A),{id:"edit-title",modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=e=>w.value=e),placeholder:"纪念日标题"},null,8,["modelValue"])]),m("div",He,[l(t(G),{for:"edit-date"},{default:n(()=>[...a[10]||(a[10]=[x("日期",-1)])]),_:1}),l(t(A),{id:"edit-date",modelValue:E.value,"onUpdate:modelValue":a[3]||(a[3]=e=>E.value=e),type:"date"},null,8,["modelValue"])]),l(t(De),null,{default:n(()=>[l(t(T),{type:"button",variant:"outline",onClick:W},{default:n(()=>[...a[11]||(a[11]=[x("取消",-1)])]),_:1}),l(t(T),{type:"submit"},{default:n(()=>[...a[12]||(a[12]=[x("保存",-1)])]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])])]))}});export{Xe as default};
